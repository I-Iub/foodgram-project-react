![YaMDB](https://github.com/I-Iub/yamdb_final/actions/workflows/yamdb_workflow.yml/badge.svg)

## Оглавление
- [Описание](#description)
- [Установка с помощью GitHub](#setup_with_github)
- [Установка с помощью Dockerhub](#setup_with_dockerhub)
- [Примеры запросов через API](#examples)
- [Команда для добавления данных в базу](#command)
- [Ссылка на сервис в интернете](#link)

<a id=description></a>
## Описание
YaMDB - проект, выполненый с использованием библиотеки [Django REST Framework](https://www.django-rest-framework.org/) фреймворка [Django](https://www.djangoproject.com/). Проект позволяет пользователям публиковать отзывы на произведения различных категорий (музыка, фильмы и т.д.). Категории произведений и сами произведения создаются администратором. Кроме прав администратора, пользователи могут обладать правами модератора или аутентифицированного пользователя или анонимного пользователя. Суперпользователь обладает правами администратора. Произведению может быть присвоен один или несколько жанров. К отзывам на произведения пользователи могут оставлять комментарии. Обмен информацией между клиентами пользователей и сервером происходит посредством интерфейса API. Проект может быть полезен тем, кто хочет выбрать какой фильм посмотреть, какую музыку послушать, какую книгу почитать. Для этого пользователь может почитать различные отзывы на произведения, комментарии к отзывам, и решить, стоит ли произведение его внимания. А после того как пользователь посмотрит фильм, прочитает книгу, или послушает какое-то музыкальное произведение, он может оставить свой отзыв на него, обсудить его в комментариях к отзыву. Проект YaMDB предоставляет широкие возможности для этого. :upside_down_face:

---
<a id=setup_with_github></a>
## Установка с помощью GitHub
Установите Docker, если он не установлен. Инструкция по установке, например, на Ubuntu по этой [ссылке](https://docs.docker.com/engine/install/ubuntu/).
Все нижеследующие инструкции выполняйте в консоли. Если не вносить изменения в соответствующие файлы, то проект будет доступен на локальном хосте 127.0.0.1.
Первым делом необходимо клонировать проект с github.com. В консоли выполните:
```
git clone https://github.com/I-Iub/yamdb_final.git
```
Перейдите в корневую папку проекта "yamdb_final" (в ней находится файл Dockerfile). В корневой папке необходимо создать файл ".env". Содержание файла должно быть таким:
```
DB_ENGINE=django.db.backends.postgresql
DB_NAME=postgres
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres  # укажите свой пароль
DB_HOST=db
DB_PORT=5432
```
Последующие команды скорее всего потребуется вводить команды от имени администратора, т.е. перед каждой командой нужно писать "sudo".
Запустите создание образов и развертывание контейнеров:
```
docker-compose up
```
В консоли можно будет увидеть, что создано и запущено три контейнера: "web_1", "nginx_1", "db_1". Если всё прошло успешно, в используемом терминале нельзя будет вводить команды, можно только просматривать логи. Откройте новый терминал, снова перейдите в корневую папку проекта "yamdb_final". Последовательно выполните команды:
 - создания миграций
```
docker-compose exec web python manage.py makemigrations
```
 - применения миграций
```
docker-compose exec web python manage.py migrate --noinput
```
 - создания суперпользователя
После этой команды потребуется ввести имя пользователя, адрес электронной почты и пароль.
```
docker-compose exec web python manage.py createsuperuser
```
 - сбора статики
```
docker-compose exec web python manage.py collectstatic --no-input
```
Приложение готово к работе.
Для того, чтобы остановить контейнеры, необходимо выполнить:
```
docker-compose down
```
---
<a id=setup_with_dockerhub></a>
## Установка с помощью Dockerhub
Данная инструкция описывает как развернуть проект на примере сервера. И применима для установки на других машинах, которые не обязательно являются сервером. Чтобы этот способ сработал на машине, на которой разварачивается проект, должен быть установлен Docker. Инструкция по установке Docker, например, на сервере с операционной системой Ubuntu по этой [ссылке](https://docs.docker.com/engine/install/ubuntu/).
Для того, чтобы развернуть проект используя образ, сохраненный на DockerHub необходимо скачать на сервер файлы "docker-compose.yaml" и папку с файлом "/nginx/default.conf". Эти файлы находятся в корневой директории [репозитория](https://github.com/I-Iub/yamdb_final.git) на GitHub. Указанные файл и папку необходимо поместить в одной директории на сервере. Запистите терминал, перейдите в папку с этими файлами. Выполните команду:
```
sudo docker-compose up
```
В консоли можно будет увидеть, что создано и запущено три контейнера: "web_1", "nginx_1", "db_1". Если всё прошло успешно, в используемом терминале нельзя будет вводить команды, можно только просматривать логи. Откройте новый терминал, снова перейдите в папку c файлами "docker-compose.yaml" и "/nginx/default.conf". Последовательно выполните команды:
 - создания миграций
```
docker-compose exec web python manage.py makemigrations
```
 - применения миграций
```
docker-compose exec web python manage.py migrate --noinput
```
 - создания суперпользователя
После этой команды потребуется ввести имя пользователя, адрес электронной почты и пароль.
```
docker-compose exec web python manage.py createsuperuser
```
 - сбора статики
```
docker-compose exec web python manage.py collectstatic --no-input
```
Приложение готово к работе.
Для того, чтобы остановить контейнеры, необходимо выполнить:
```
docker-compose down
```

---
<a id=examples></a>
## Примеры запросов через API
##### GET-запрос на получение списка произведений
Запрос могут выполнять авторизованные и неавторизованные пользователи. Чтобы получить все публикации, необходимо выполнить GET-запрос к эндпоинту:
```
http://127.0.0.1/api/v1/titles/
```
Пример выше для запроса к приложению, запущенному локально на компьютере. Если проект запущен на сервере, укажите ip сервера вместо "127.0.0.1".
Пример ответа:
```
[
    {
        "count": 0,
        "next": "string",
        "previous": "string",
        "results": [
            {
                "id": 0,
                "name": "string",
                "year": 0,
                "rating": 0,
                description": "string",
                "genre": [
                    {
                        "name": "string",
                        "slug": "string"
                    }
                        ],
                "category": 
                    {
                        "name": "string",
                        "slug": "string"
                    }
            }
        ]
    }
]
```

##### GET-запрос на получение списка публикаций с пагинацией
Также доступна пагинация. Можно в запросе указывать количество произведений, которые должны выводится на страницу - параметр `limit`. А также указывать параметр `offset`. Публикации будут выводится на страницу начиная со следующего по порядку номеру после номера, переданного в параметре `offset`. Например, чтобы получить два произведения на странице, начиная с четвертого (`offset=3`), необходимо выполнить GET-запрос к эндпоинту:
```
http://127.0.0.1/api/v1/titles/?limit=2&offset=3
```
Пример ответа:
```
[
    {
        "count": 6,
        "next": "http://127.0.0.1:8000/api/v1/titles/?limit=2&offset=5",
        "previous": "http://127.0.0.1:8000/api/v1/titles/?limit=2&offset=1",
        "results": [
            {
                "id": 0,
                "name": "string",
                "year": 0,
                "rating": 0,
                description": "string",
                "genre": [
                    {
                        "name": "string",
                        "slug": "string"
                    }
                        ],
                "category": 
                    {
                        "name": "string",
                        "slug": "string"
                    }
            }
        ]
    }
]
```
Примеры других запросов и ответов можно посмотреть в браузере. Для этого при запущенном приложении необходимо ввести в строку браузера `http://127.0.0.1/redoc/`.

---
<a id=command></a>
## Команда для добавления данных в базу
Для переноса данных из файлов формата .csv в базу данных в консоли введите команду:
```
python manage.py load_data
```
При этом в папке static/data/ должны быть следующие файлы:
- category.csv
- comments.csv
- genre_title.csv
- review.csv
- title.csv
- users.csv

---
<a id=link></a>
## Ссылка на сервис в интернете
Адрес развернутого проекта в интернете: [http://www.eduserver.xyz/redoc/](http://www.eduserver.xyz/redoc/).
